I"˙)<p>In this article, I will use <code class="highlighter-rouge">http.server</code> that python‚Äôs build-in server module to demonstrate how to use cgi and explain what is cig. my environment is python3. Have a pleasant reading.</p>
<h1 id="what-is-cgi">What is CGI</h1>
<p>Common Gateway Interface(CGI) is a set of standard protocols to define how data exchanges between webserver and custom scripts.</p>

<p>Let us think about this scenario:</p>
<ol>
  <li>When a hyperlink requesting arrived at webserver. the server will parse the URL and demands(for example: a filename).</li>
  <li>The server will look through the corresponding file and return the file content to the requesting client.</li>
  <li>The requesting client display contents that webserver returned.</li>
</ol>

<p>The above steps are the process for a static web page. However, the server can be configured to that the requested file in a specified directory does not be sent back, instead it‚Äôs executed as a program. and whatever the output of the program will be sent back to the browser client. this functionality is called Common Gateway Interface. Common Gateway Interface has laid a foundation for dynamical web pages.</p>

<p>Common Gateway Interface Architecture Diagram</p>

<p><img src="/blog/public/img/2019-10-08-Running-A-CGI-Web-Server-With-http-server-Module-cgi-diagram.png" alt="Alt" /></p>

<h1 id="httpserver">http.server</h1>
<p>The <code class="highlighter-rouge">http.server</code> module defines classes for implementing HTTP servers(web servers).</p>

<p>According to official documents in python3.7, the <code class="highlighter-rouge">server_address</code> and <code class="highlighter-rouge">http_handler_class</code> should be provided when starting up a webserver with <code class="highlighter-rouge">http.server</code> module.</p>

<p>Below is a simple example:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">http.server</span>
<span class="kn">import</span> <span class="nn">socketserver</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">server_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">,</span> <span class="n">handler_class</span><span class="o">=</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="n">server_address</span> <span class="o">=</span> <span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">server_class</span><span class="p">(</span><span class="n">server_address</span><span class="p">,</span> <span class="n">handler_class</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="n">run</span><span class="p">(</span><span class="n">server_class</span> <span class="o">=</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">,</span> <span class="n">handler_class</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">)</span>
</code></pre></div></div>
<p>Put the above contents into <em>index.py</em> file. in the same directory of <em>index.py</em> in command prompt, input the <code class="highlighter-rouge">python index.py</code> and running. Then the webserver is starting up and serving files relative to the current directory.</p>

<p>However, except starting from code, the server can also start from the command prompt. use the <code class="highlighter-rouge">-m</code> switch of the interpreter with a <em>port number</em> argument.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="mi">8000</span>
</code></pre></div></div>
<p>The webserver serves files relative to the current directory.</p>

<p>All of the above snippets are not relative to the Common Gateway Interface. By default, a lot of web servers do not boot the CGI functionality. the programmer must configure manually it to start. the python has provided the  <code class="highlighter-rouge">http.server.CGIHTTPRequestHandler</code>  class to handle only the CGI functionality.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#use the above run method
</span><span class="n">run</span><span class="p">(</span><span class="n">server_class</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">,</span> <span class="n">handler_class</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">CGIHTTPRequestHandler</span><span class="p">)</span>
</code></pre></div></div>
<p>And the <code class="highlighter-rouge">CGIHTTPRequestHandler</code> can be enabled in the command line with <code class="highlighter-rouge">--cgi</code> option.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="o">--</span><span class="n">cgi</span> <span class="mi">8000</span>
</code></pre></div></div>

<h1 id="cgi-example">CGI Example</h1>
<p>In this chapter, we will demonstrate a simple example that will print ‚Äúhello world‚Äù.</p>

<p><strong>First: create a CGI directory</strong></p>

<p>create a directory <em>cgi-bin</em> in <em>basepath</em>. The directory name can be only <em>cgi-bin</em> or <em>htbin</em>.</p>

<p><strong>Second: create a python script</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="c1"># Import modules for CGI handling 
</span><span class="kn">import</span> <span class="nn">cgi</span><span class="p">,</span> <span class="n">cgitb</span> 

<span class="c1"># Create instance of FieldStorage 
</span><span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span> 

<span class="c1"># Get data from fields
</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">'first_name'</span><span class="p">)</span>
<span class="n">last_name</span>  <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">'last_name'</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">"Content-type:text/html</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;html&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;head&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;title&gt;Hello&lt;/title&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;/head&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;body&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;h2&gt;Hello World, </span><span class="si">%</span><span class="s">s </span><span class="si">%</span><span class="s">s&lt;/h2&gt;"</span> <span class="o">%</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">))</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;/body&gt;"</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"&lt;/html&gt;"</span><span class="p">)</span>
</code></pre></div></div>
<p>put the above script into the <em>hello.py</em> file in directory <em>basepath/cgi-bin</em>.</p>

<p><strong>Third: start-server</strong></p>

<p>start the server in command prompt in directory <em>basepath</em> with below commanding:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="o">--</span><span class="n">cgi</span> <span class="mi">8000</span>
</code></pre></div></div>

<p>Then access <a href="http://localhost:8000/cgi-bin/hello.py?first_name=jame&amp;last_name=curry" title="link">http://localhost:8000/cgi-bin/hello.py?first_name=jame&amp;last_name=curry</a> in the browser client.
<img src="/blog/public/img/2019-10-08-Running-A-CGI-Web-Server-With-http-server-Module-a.png" alt="Alt" /></p>

<h1 id="conclusion">Conclusion</h1>
<p>CGI is the Common Gateway Interface that defines the standard exchange format between webserver and custom scripts.</p>

<p>With <code class="highlighter-rouge">http.server</code> module, the programmer can build a web server quickly. a lot of web server does not boot up CGI functionality by default. In python, use the <code class="highlighter-rouge">CGIHTTPRequestHandler</code> class to handle cig request or <code class="highlighter-rouge">-m</code> switch of the interpreter in the command line. read more about http.server at <a href="https://docs.python.org/3/library/http.server.html">http.server library</a>.</p>

<p>Okay, everything is settled up. Today is the first working day after the  7-day national holiday. Have a nice day at work!</p>

:ET